ご指示いただいた変更点（モバイルファースト、Q5の差し替え、正答データの確定、複数選択UI、BGM機能）を反映し、開発エージェントが迷いなく実装できるよう `AGENTS.md` を洗練させました。

特に**「スマホでの操作性」**と**「クイズ番組のような演出」**の両立、および**「複数選択解答」**のロジック部分を詳細化しています。

---

# Quiz-Med-Battle-Demo 開発エージェント向けガイドライン

## プロジェクト概要

**プロジェクト名:** みんなで早押し！医師国家試験クイズ 体験版
**目的:** 医師国家試験の過去問を用いた、エンターテイメント性の高い早押しクイズWebアプリの開発。
**ターゲット:** 医学生、医療関係者。
**デプロイ先:** GitHub Pages (`/docs` ディレクトリ)
**重要:** **Mobile First Design**。スマートフォンでの体験を最優先し、PCなどの大画面では中央にスマホ画面サイズのコンテンツを表示しつつ、背景演出で余白を埋めるレスポンシブ対応を行う。

## 技術スタック

* **Framework:** React (Vite)
* **Language:** TypeScript
* **Styling:** Tailwind CSS (モバイルフレンドリーなレイアウト、グリッドシステム)
* **Animation:** Framer Motion (回答時のカットイン、スコア変動、正誤判定演出)
* **State Management:** Zustand (ゲーム進行、スコア、オーディオ設定管理)
* **Audio:** Web Audio API または `use-sound` (BGM、SE再生)
* **Routing:** React Router（**HashRouter**）

## デザイン & UXコンセプト

* **モバイルファースト:** ボタンは親指で押しやすいサイズと配置。重要な情報は画面上部（問題）と下部（操作系）に集約。
* **「黒猫のウィズ」系の魔法学園ファンタジー:** 魔法学校の図書館を基調に、**ゴシック×アンティーク×ファンタジー**の雰囲気で統一。
* **アートディレクション:**
* 深いネイビー/エメラルド/バーガンディをベースに、**金縁・宝石感・魔法陣**のアクセント。
* UIフレームは**装飾枠（エンボス/箔押し風）**で高級感を出す。
* ボタンは**発光するルーン**や**宝石ボタン**をイメージし、押下時に粒子が散る。
* **TVショー演出:**
* 「正解！」の文字は画面からはみ出るほどの勢いで表示。
* カウントダウンや得点変動は、ネオンではなく**魔法光・エフェクト**（光条/パーティクル/魔法陣）で派手に。
* 静的な瞬間を作らない（待機中も背景やアバターが呼吸するように動く）。


* **サウンド:** 没入感を高めるBGMと、爽快感のあるSE（決定音、正解音）。**常時表示のミュートボタン**を実装する。
* **Web Audio注意:** 自動再生制限があるため、**ユーザー操作後にAudioContextを解錠**してから再生する。

## 画面仕様と遷移

### 共通要素

* **Header/Overlay:** 右上に「BGM/SE ON/OFF」切り替えボタン（アイコン）。
* **Background:** **魔法学校の図書館（黒猫のウィズのような世界観）**のファンタジックなイラスト。モバイルでは画面全体、PCでは中央のスマホサイズエリアに表示し、余白は背景で埋める。
* **UI装飾:** パネルは**羊皮紙/古書**の質感。角に装飾。影は柔らかく、魔法灯の照明を意識。
* **タイポグラフィ:** 明朝系/筆記体風のタイトルロゴ。本文は読みやすいが少しクラシカルな印象を残す。

### 1. ランディング & プレイヤー登録画面 (`/`)

* **UI:** スマホ画面中央に**金縁のタイトルロゴ**。
* **Action:** プレイヤーネーム入力後、**魔法陣が回転しながら発光**する「START」ボタンで次へ。

### 2. ロビー選択画面 (`/lobby`)

* **UI:** **魔導書の目次**のようなサーバーリスト風デザイン。
* **Gimmick:**
* 「満員」の部屋と「空きあり」の部屋を混在させる。
* 入室クリック時、「通信環境チェック中...」「Ping: 12ms 同期確立」といった**フェイクのアラートモーダル**を表示し、緊張感を演出してから遷移。



### 3. 待機 & カウントダウン画面 (`/waiting`)

* **UI:**
* 自分と対戦相手（CPU 5名）のアバターパネルが**魔法陣に召喚**される演出。
* 中央で「10」カウントダウン。**魔法の鼓動**SEと連動。


* **Tips表示:** 「答えは複数ある場合も！」「誰よりも早く正解せよ！」等のルールをアニメーション表示。

### 4. ゲームメイン画面 (`/game`)

* **レイアウト (縦長想定):**
* **上部 (20%):** ラウンド数、残り時間ゲージ（30秒バーが減っていく）。
* **中部 (40%):** 問題文エリア。タイプライター風に文字が出現。
* **下部 (40%):**
* 選択肢ボタン (a〜e) 5つ。**複数選択可能**（トグル式）。選択すると**魔法陣の発光**で強調。
* その下に大きな「解答する！」ボタン（**宝石発光**）。
* 最下部に小さく他プレイヤーの状況アイコン（回答済み/未回答）。




* **CPU挙動:**
* 10〜25秒の間にランダムでステータスが「回答済み」に変わる。
* 60%の確率で正解判定、40%で不正解判定を持つ（内部ロジック）。


* **プレイヤー操作:**
* 選択肢をタップ（複数可）→「解答する」タップでロック。
* 回答後は「判定待ち...」のエフェクト。


* **判定フェーズ:**
* 全員回答 or 時間切れでカットイン演出。
* **判定ロジック:**
* プレイヤーの選択が完全一致した場合のみ「正解」。
* **スコア計算:**
* 正解者の中で、回答タイムが最も早い人: **+20pt**
* それ以外の正解者: **+10pt**
* 不正解: **0pt**
* **正答表示:** 判定フェーズで正答選択肢を表示する（**4秒間表示**）。




* 順位変動アニメーション。



### 5. 結果発表画面 (`/result`)

* **UI:**
* 1位のプレイヤーを派手に表彰（**魔法光・祝福の紋章・紙吹雪**）。
* 全プレイヤーのスコアリスト。


* **Action:** 「トップに戻る」ボタン。

## データ構造 (src/data/questions.ts)

`questions.ts` で大量の問題データを一括管理する。今後も追加・削除・差し替えが適宜行われる前提で、問題の順序や件数に依存しない実装にすること。

以下の形式でデータを保持する。`correctAnswers` は配列で保持し、複数回答に対応する。`sourceId` は出典IDで、例として `119A75` は「第119回医師国家試験の A 問題・75 問目」を意味する。

```typescript
type Question = {
  id: number;
  text: string;
  options: { id: string; text: string }[];
  correctAnswers: string[]; // 複数正解に対応 (例: ['c', 'e'])
  sourceId: string; // 出典ID (例: '119A75')
};

// 問題データ
const questions: Question[] = [
  {
    id: 1,
    text: "自己免疫性膵炎で誤っているのはどれか。",
    options: [
      { id: 'a', text: "ａ 膵の萎縮を認める。" },
      { id: 'b', text: "ｂ 高齢男性に好発する。" },
      { id: 'c', text: "ｃ 病理で線維化を認める。" },
      { id: 'd', text: "ｄ IgG4 関連疾患に含まれる。" },
      { id: 'e', text: "ｅ 治療はグルココルチコイド投与が第一選択である。" }
    ],
    correctAnswers: ['a'] // 誤りを選択
  },
  {
    id: 2,
    text: "パソコンで長時間の作業をする若年労働者に生じやすい、頸部痛と上肢のしびれをきたす疾患はどれか。",
    options: [
      { id: 'a', text: "ａ 頸肩腕障害" },
      { id: 'b', text: "ｂ 肩関節周囲炎" },
      { id: 'c', text: "ｃ 肘部管症候群" },
      { id: 'd', text: "ｄ 変形性頸椎症" },
      { id: 'e', text: "ｅ 頸椎後縦靱帯骨化症" }
    ],
    correctAnswers: ['a']
  },
  {
    id: 3,
    text: "Which of the following is the most common site of hypertensive intracerebral hemorrhage?",
    options: [
      { id: 'a', text: "ａ Amygdala" },
      { id: 'b', text: "ｂ Hippocampus" },
      { id: 'c', text: "ｃ Hypothalamus" },
      { id: 'd', text: "ｄ Putamen" },
      { id: 'e', text: "ｅ Red nucleus" }
    ],
    correctAnswers: ['d']
  },
  {
    id: 4,
    text: "疾患と好発部位の組合せで誤っているのはどれか。",
    options: [
      { id: 'a', text: "ａ 疥　癬 --- 外陰部" },
      { id: 'b', text: "ｂ ケロイド --- 耳　介" },
      { id: 'c', text: "ｃ 脂腺母斑 --- 頭　部" },
      { id: 'd', text: "ｄ 血管性浮腫 --- 口　唇" },
      { id: 'e', text: "ｅ ケラトアカントーマ --- 臍　部" }
    ],
    correctAnswers: ['e'] // 誤りを選択
  },
  {
    id: 5,
    text: "随時血糖 250 mg/dL を示す非妊娠者で糖尿病の診断基準を満たすのはどれか。2 つ選べ。",
    options: [
      { id: 'a', text: "ａ 尿糖陽性" },
      { id: 'b', text: "ｂ 尿蛋白陽性" },
      { id: 'c', text: "ｃ HbA1c 6.7 %" },
      { id: 'd', text: "ｄ 尿ケトン体陽性" },
      { id: 'e', text: "ｅ 口渇、多飲、多尿の症状" }
    ],
    correctAnswers: ['c', 'e']
  }
];

```

## サウンドアセット要件 (Mock/Free Assets)

* **BGM:**
* Title/Lobby: `Dawn_s_First_Ascent.mp3`
* Lobby（アルカナ図書館を選択）: `The_Gauntlet_of_Triumph.mp3`
* Lobby（蒼穹の書架を選択）: `Crimson_Horizon.mp3` / `Aetherium_Arena.mp3` を順番ループ
* Lobby（深層迷宮の間を選択）: `The_Grand_Inquisitor_s_Gambit.mp3`
* Lobby（それ以外の部屋）/Game: 以下の5曲を順番にループ再生
* `The_Final_Question.mp3`
* `The_Accordion_s_Anarchy.mp3`
* `The_Final_Countdown.mp3`
* `The_Grand_Gauntlet.mp3`
* `The_Grand_Triumvirate.mp3`
* Result: ファンファーレ風の明るい曲。


* **SE:**
* Click: システム的な決定音。
* Countdown: 1秒ごとのビープ音を小さく。ゼロでブザー。
* Correct: クイズ番組風の「ピンポン！」。
* Wrong: 「ブブー！」
* Score Up: コイン獲得のような音。



## ビルド・デプロイ設定

* **Vite Config:** `base: '/quiz-med-battle-demo/'`, `outDir: 'docs'`
* **Build:** GitHub Pagesでのホスティングを前提とした静的出力。
